<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">

    <!-- Content Security Policy removed due to GitHub Pages limitations and theme switcher conflicts -->

    {{ $title := .Title }}
    {{ $siteTitle := .Site.Title }}
    {{ $cleanTitle := $title }}
    
    {{ if and $title (ne $title "") }}
        {{/* Remove common redundant phrases to avoid word repetitions */}}
        {{ $cleanTitle = replace $title "Peter Warnock" "" }}
        {{ $cleanTitle = replace $cleanTitle "Personal portfolio and blog of" "" }}
        {{ $cleanTitle = replace $cleanTitle "  " " " }}
        {{ $cleanTitle = replace $cleanTitle "- " "" }}
        {{ $cleanTitle = replace $cleanTitle " - " "" }}
        {{ $cleanTitle = trim $cleanTitle " " }}
        
        {{/* Check if title is too long (rough character count > 50 for 580px limit) */}}
        {{ if gt (len $cleanTitle) 50 }}
            {{/* For long titles, truncate smartly */}}
            <title>{{ slicestr $cleanTitle 45 }} | {{ $siteTitle }}</title>
        {{ else if ne $cleanTitle "" }}
            {{/* For normal titles, use full title */}}
            <title>{{ $cleanTitle }} | {{ $siteTitle }}</title>
        {{ else }}
            {{/* Fallback if title becomes empty after cleaning */}}
            <title>{{ $title }} | {{ $siteTitle }}</title>
        {{ end }}
    {{ else }}
        {{/* Homepage or pages without title - use site title with tagline */}}
        <title>{{ $siteTitle }} | Fullstack Developer & Technology Leader</title>
        {{ $cleanTitle = "Fullstack Developer & Technology Leader" }}
    {{ end }}
    <meta name="description" content="{{ if .Description }}{{ .Description }}{{ else }}{{ .Site.Params.description }}{{ end }}">

    <!-- SEO Meta Tags -->
    <meta name="author" content="{{ .Site.Params.Author.name | default .Site.Title }}">
    <meta name="keywords" content="{{ if .Params.tags }}{{ delimit .Params.tags ", " }}, {{ end }}{{ .Site.Params.keywords | default "fullstack developer, devops, cloud engineering, technology leader" }}">
    <meta name="robots" content="index, follow">
    <meta name="language" content="{{ .Site.LanguageCode }}">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ .Permalink }}">
    <meta property="og:title" content="{{ if and $title (ne $title "") }}{{ if gt (len $cleanTitle) 50 }}{{ slicestr $cleanTitle 45 }} | {{ $siteTitle }}{{ else }}{{ $cleanTitle }} | {{ $siteTitle }}{{ end }}{{ else }}{{ $siteTitle }} | Fullstack Developer & Technology Leader{{ end }}">
    <meta property="og:description" content="{{ if .Description }}{{ .Description }}{{ else }}{{ .Site.Params.description }}{{ end }}">
    <meta property="og:image" content="{{ if .Params.image }}{{ .Params.image | absURL }}{{ else }}{{ .Site.Params.og_image | default "/img/og-image.png" | absURL }}{{ end }}">
    <meta property="og:site_name" content="{{ .Site.Title }}">
    <meta property="og:locale" content="{{ .Site.LanguageCode }}">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="{{ .Permalink }}">
    <meta property="twitter:title" content="{{ if and $title (ne $title "") }}{{ if gt (len $cleanTitle) 50 }}{{ slicestr $cleanTitle 45 }} | {{ $siteTitle }}{{ else }}{{ $cleanTitle }} | {{ $siteTitle }}{{ end }}{{ else }}{{ $siteTitle }} | Fullstack Developer & Technology Leader{{ end }}">
    <meta property="twitter:description" content="{{ if .Description }}{{ .Description }}{{ else }}{{ .Site.Params.description }}{{ end }}">
    <meta property="twitter:image" content="{{ if .Params.image }}{{ .Params.image | absURL }}{{ else }}{{ .Site.Params.og_image | default "/img/og-image.png" | absURL }}{{ end }}">
    {{ if .Site.Params.twitter }}<meta property="twitter:site" content="{{ .Site.Params.twitter }}">{{ end }}

    <!-- Canonical URL -->
    <link rel="canonical" href="{{ .Permalink }}">

    {{ partial "security-headers.html" . }}

    <!-- DNS Prefetch for performance -->
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://github.com">
    <link rel="dns-prefetch" href="https://linkedin.com">
    <link rel="dns-prefetch" href="https://x.com">

    <!-- Structured Data -->
    <script type="application/ld+json">
    {{ if eq .Type "page" }}
      {{ if eq .Title "About" }}
        {
          "@context": "https://schema.org",
          "@type": "Person",
          "name": "Peter Warnock",
          "jobTitle": "Cloud Engineering & DevOps Leadership",
          "url": "{{ .Site.BaseURL }}",
          "sameAs": [
            "https://github.com/pwarnock",
            "https://www.linkedin.com/in/peterwarnock",
            "https://x.com/pwarnock"
          ],
          "knowsAbout": [
            "Cloud Engineering",
            "DevOps",
            "Fullstack Development",
            "AI Tools",
            "Technology Leadership"
          ]
        }
      {{ else }}
        {
          "@context": "https://schema.org",
          "@type": "WebSite",
          "name": "{{ .Site.Title }}",
          "url": "{{ .Site.BaseURL }}",
          "description": "{{ .Site.Params.description }}",
          "author": {
            "@type": "Person",
            "name": "Peter Warnock"
          },
          "publisher": {
            "@type": "Person",
            "name": "Peter Warnock"
          }
        }
      {{ end }}
    {{ else }}
      {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "{{ .Site.Title }}",
        "url": "{{ .Site.BaseURL }}",
        "description": "{{ .Site.Params.description }}",
        "author": {
          "@type": "Person",
          "name": "Peter Warnock"
        },
        "publisher": {
          "@type": "Person",
          "name": "Peter Warnock"
        }
      }
    {{ end }}
    </script>

    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" href="/favicon.ico">

    <!-- RSS Feed -->
    {{ with .OutputFormats.Get "rss" }}
    <link href="{{ .RelPermalink }}" rel="alternate" type="application/rss+xml" title="{{ $.Site.Title }}" />
    {{ end }}

    <!-- JSON-LD Structured Data -->
    {{- $site := .Site }}
    {{- $page := . }}
    {{- $url := .Permalink }}
    {{- $title := .Title }}
    {{- $description := .Description | default .Site.Params.description }}
    {{- $image := .Params.image | default "/img/logo.png" }}
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@graph": [
        {{- if eq .Kind "home" }}
        {
          "@type": "Person",
          "@id": "{{ $site.BaseURL }}#person",
          "name": "Peter Warnock",
          "url": "{{ $site.BaseURL }}",
          "description": "{{ $description }}",
          "jobTitle": "Cloud & Platform Engineering Leader",
          "knowsAbout": [
            "Cloud Engineering",
            "DevOps",
            "Fullstack Development",
            "Software Architecture",
            "Team Leadership"
          ],
          "sameAs": [
            "https://www.linkedin.com/in/peterwarnock/",
            "https://github.com/pwarnock/",
            "https://x.com/pwarnock/"
          ],
          "image": "{{ $image | absURL }}"
        },
        {
          "@type": "WebSite",
          "@id": "{{ $site.BaseURL }}#website",
          "url": "{{ $site.BaseURL }}",
          "name": "{{ $site.Title }}",
          "description": "{{ $description }}",
          "publisher": {
            "@id": "{{ $site.BaseURL }}#person"
          },
          "inLanguage": "en-US"
        }
        {{- else if eq .Kind "section" }}
        {
          "@type": "Blog",
          "@id": "{{ $url }}#blog",
          "url": "{{ $url }}",
          "name": "{{ $title }}",
          "description": "{{ $description }}",
          "publisher": {
            "@id": "{{ $site.BaseURL }}#person"
          },
          "inLanguage": "en-US"
        }
        {{- else if eq .Kind "page" }}
        {
          "@type": "Article",
          "@id": "{{ $url }}#article",
          "url": "{{ $url }}",
          "headline": "{{ $title }}",
          "description": "{{ $description }}",
          "datePublished": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
          {{- if .Lastmod }}
          "dateModified": "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}",
          {{- end }}
          "author": {
            "@id": "{{ $site.BaseURL }}#person"
          },
          "publisher": {
            "@id": "{{ $site.BaseURL }}#person"
          },
          "image": "{{ $image | absURL }}",
          "inLanguage": "en-US"
          {{- if .Params.categories }},
          "about": [
            {{- range $i, $category := .Params.categories }}
            {{- if $i }}, {{ end }}"{{ $category }}"
            {{- end }}
          ]
          {{- end }}
          {{- if .Params.tags }},
          "keywords": [
            {{- range $i, $tag := .Params.tags }}
            {{- if $i }}, {{ end }}"{{ $tag }}"
            {{- end }}
          ]
          {{- end }}
        }
        {{- else }}
        {
          "@type": "WebPage",
          "@id": "{{ $url }}#webpage",
          "url": "{{ $url }}",
          "name": "{{ $title }}",
          "description": "{{ $description }}",
          "isPartOf": {
            "@id": "{{ $site.BaseURL }}#website"
          },
          "inLanguage": "en-US"
        }
        {{- end }}
      ]
    }
    </script>

    <!-- Google Tag Manager -->
    {{ if eq (getenv "HUGO_ENV") "production" }}
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','{{ getenv "HUGO_GTM_CONTAINER_ID" }}');</script>
    {{ end }}

    {{ $css := resources.Get "css/main.css" | css.PostCSS | minify }}
<link rel="stylesheet" href="{{ $css.RelPermalink }}">

    <!-- Accessibility enhancements -->
    <style>
        /* Enhanced focus indicators for better keyboard navigation */
        :focus-visible {
            outline: 2px solid currentColor;
            outline-offset: 2px;
        }

        /* Skip link styling */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Respect reduced motion preferences */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }

        /* Enhanced focus for interactive elements */
        a:focus-visible,
        button:focus-visible,
        input:focus-visible,
        textarea:focus-visible,
        select:focus-visible {
            outline: 2px solid currentColor;
            outline-offset: 2px;
            box-shadow: 0 0 0 2px currentColor;
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            .card {
                border: 2px solid currentColor;
            }
        }
    </style>

    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.1/dist/cdn.min.js"
            integrity="sha384-l8f0VcPi/M1iHPv8egOnY/15TDwqgbOR1anMIJWvU6nLRgZVLTLSaNqi/TOoT5Fh"
            crossorigin="anonymous"></script>

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": {{ if .IsHome }}"WebSite"{{ else if .IsPage }}"BlogPosting"{{ else }}"WebPage"{{ end }},
        "name": "{{ .Site.Title }}",
        "description": "{{ if .Description }}{{ .Description }}{{ else }}{{ .Site.Params.description }}{{ end }}",
        "url": "{{ .Permalink }}",
        "author": {
            "@type": "Person",
            "name": "{{ .Site.Params.Author.name | default .Site.Title }}",
            "url": "{{ .Site.BaseURL }}"
        }{{ if .IsPage }},
        "datePublished": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
        "dateModified": "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}",
        "headline": "{{ .Title }}"{{ if .Params.tags }},
        "keywords": "{{ delimit .Params.tags ", " }}"{{ end }}{{ end }}
    }
    </script>
</head>
<body>
<!-- Google Tag Manager (noscript) -->
{{ if eq (getenv "HUGO_ENV") "production" }}
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id={{ getenv "HUGO_GTM_CONTAINER_ID" }}"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    {{ end }}

    <!-- Skip to main content link for keyboard users -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-primary text-primary-content rounded-md z-50 focus:outline-none focus:ring-2 focus:ring-primary-focus" style="padding: var(--space-2) var(--space-4)">
        Skip to main content
    </a>

    {{ partial "header.html" . }}

    <!-- Hero Sections for Section Pages and Single Posts (outside main) -->
    {{ if or (and (or (eq .Type "blog") (eq .Type "portfolio") (eq .Type "tools")) (eq .Kind "section")) (and (or (eq .Type "posts") (eq .Section "blog") (eq .Type "portfolio") (eq .Type "tools")) (eq .Kind "page")) }}
      {{ if or (eq .Kind "section") (eq .Kind "page") }}
        <!-- Section page and single post: Breadcrumbs above hero -->
        {{ if not .Params.hideBreadcrumbs }}
        <div class="container mx-auto px-4 py-4">
          {{ partial "components/breadcrumbs.html" . }}
        </div>
        {{ end }}
      {{ end }}

      <!-- Hero configuration -->
      {{ $heroLayout := .Type }}
      {{ $heroBackground := "gradient-primary" }}
      {{ $heroTitle := .Title }}
      {{ $heroDescription := "" }}
      {{ $heroShowDate := false }}
      {{ $heroShowTags := false }}

      {{ if eq .Kind "section" }}
        {{ if eq .Type "blog" }}
          {{ $heroBackground = "gradient-br" }}
        {{ else if eq .Type "portfolio" }}
          {{ $heroBackground = "gradient-subtle" }}
        {{ else if eq .Type "tools" }}
          {{ $heroBackground = "gradient-primary" }}
        {{ end }}
      {{ else if eq .Kind "page" }}
        <!-- Single post/page hero configuration -->
        {{ if or (eq .Type "posts") (eq .Section "blog") }}
          {{ $heroBackground = "gradient-br" }}
          {{ $heroShowDate = true }}
          {{ $heroShowTags = true }}
          {{ $heroDescription = .Description }}
          {{ $heroLayout = "blog" }}
        {{ else if eq .Type "portfolio" }}
          {{ $heroBackground = "gradient-subtle" }}
          {{ $heroShowDate = true }}
          {{ $heroShowTags = true }}
          {{ $heroDescription = .Description }}
        {{ else if eq .Type "tools" }}
          {{ $heroBackground = "gradient-primary" }}
          {{ $heroShowDate = true }}
          {{ $heroShowTags = true }}
          {{ $heroDescription = .Description }}
        {{ end }}
      {{ end }}

      {{ partial "components/hero" (dict
        "context" .
        "size" "full"
        "background" $heroBackground
        "title" $heroTitle
        "description" $heroDescription
        "layout" $heroLayout
        "showDate" $heroShowDate
        "showTags" $heroShowTags
        "isSingle" (eq .Kind "page")
      ) }}
    {{ end }}

    <main id="main-content" class="flex-grow {{ if .IsHome }}{{ else if eq .Layout "about" }}{{ else }}container mx-auto{{ end }}" style="{{ if and (not .IsHome) (ne .Layout "about") }}padding: var(--space-8) var(--space-4){{ end }}" role="main">
        {{ block "main" . }}
        {{ if .IsHome }}
            {{ .Content }}
        {{ else }}
            <!-- Global breadcrumbs for pages without heroes -->
            {{ if and (not .Params.hideBreadcrumbs) (ne .Kind "home") (not (or (and (or (eq .Type "blog") (eq .Type "portfolio") (eq .Type "tools")) (eq .Kind "section")) (and (or (eq .Type "posts") (eq .Section "blog") (eq .Type "portfolio") (eq .Type "tools")) (eq .Kind "page")))) }}
            <div class="breadcrumbs text-sm" style="margin-bottom: var(--space-6)">
                {{ partial "components/breadcrumbs.html" . }}
            </div>
            {{ end }}

            <!-- Page content -->
            <div class="max-w-none">
                {{ block "content" . }}
                    <div class="prose prose-lg max-w-none">
                        <h1 class="text-3xl lg:text-4xl font-bold" style="margin-bottom: var(--space-6)">{{ .Title }}</h1>
                        {{ .Content }}
                    </div>
                {{ end }}
            </div>
        {{ end }}
        {{ end }}
    </main>

    {{ partial "footer.html" . }}
</body>
</html>
