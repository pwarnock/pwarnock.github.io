{{/* Enhanced Unified Card Component - Replaces 6 card variants */}}
{{- $context := .context -}}
{{- $variant := .variant | default "default" -}}
{{- $title := .title | default $context.Title -}}
{{- $url := .url | default $context.Permalink -}}
{{- $size := .size | default "md" -}}
{{- $content := .content -}}
{{- $tags := .tags -}}
{{- $metadata := .metadata -}}
{{- $actions := .actions -}}
{{- $class := .class | default "" -}}
{{- $ariaLabel := .ariaLabel -}}

{{/* Extract content based on context type */}}
{{- if not $content -}}
  {{- if eq $context.Type "tools" -}}
    {{- $content = $context.Params.description | default $context.Summary -}}
    {{- $tags = $context.Params.tags -}}
  {{- else if eq $context.Type "posts" -}}
    {{- $content = $context.Params.summary | default $context.Summary -}}
    {{- $tags = $context.Params.tags -}}
  {{- else if eq $context.Type "portfolio" -}}
    {{- $content = $context.Params.summary | default $context.Summary -}}
    {{- $tags = $context.Params.technologies | default $context.Params.tags -}}
  {{- else -}}
    {{- $content = .content | default "" -}}
    {{- $tags = .tags | default slice -}}
  {{- end -}}
{{- end -}}

{{/* Build metadata */}}
{{- $metadataItems := slice -}}
{{- if $context.Date -}}
  {{- $metadataItems = $metadataItems | append (dict "icon" "calendar" "text" ($context.Date.Format "January 2, 2006") "datetime" ($context.Date.Format "2006-01-02")) -}}
{{- end -}}
{{- if $context.Params.readingTime -}}
  {{- $metadataItems = $metadataItems | append (dict "icon" "clock" "text" (printf "%d min read" $context.Params.readingTime)) -}}
{{- end -}}
{{- if $context.Params.client -}}
  {{- $metadataItems = $metadataItems | append (dict "icon" "user" "text" $context.Params.client) -}}
{{- end -}}
{{- if $metadata -}}
  {{- $metadataItems = $metadata | append $metadataItems -}}
{{- end -}}

{{/* Build actions */}}
{{- $actionButtons := slice -}}
{{- if $context.Params.external_url -}}
  {{- $actionButtons = $actionButtons | append (dict "href" $context.Params.external_url "text" "Visit Tool" "variant" "primary" "target" "_blank" "icon" "arrow-right") -}}
{{- end -}}
{{- if $url -}}
  {{- $btnText := "Read More" -}}
  {{- if eq $context.Type "tools" -}}
    {{- $btnText = "View Details" -}}
  {{- else if eq $context.Type "portfolio" -}}
    {{- $btnText = "View Project" -}}
  {{- end -}}
  {{- $actionButtons = $actionButtons | append (dict "href" $url "text" $btnText "variant" "outline" "icon" "arrow-right") -}}
{{- end -}}
{{- if $actions -}}
  {{- $actionButtons = $actions | append $actionButtons -}}
{{- end -}}

{{/* Build CSS classes */}}
{{- $classes := slice "card-system" -}}
{{- $classes = $classes | append (printf "card-system--%s" $variant) -}}
{{- $classes = $classes | append (printf "card-system--%s" $size) -}}
{{- $classes = $classes | append $class -}}

{{/* Build attributes */}}
{{- $attributes := dict "class" (delimit $classes " ") -}}
{{- if $ariaLabel -}}
  {{- $attributes = merge $attributes (dict "aria-label" $ariaLabel) -}}
{{- end -}}
{{- if $url -}}
  {{- $attributes = merge $attributes (dict "role" "article") -}}
{{- end -}}

{{/* Render card */}}
<div {{ range $key, $value := $attributes }}{{ $key }}="{{ $value }}" {{ end }}>
  <div class="card-system__content">
    {{- if $title }}
    <div class="card-system__header">
      <h3 class="card-system__title">
        {{- if $url }}
        <a href="{{ $url }}" class="card-system__title-link">
          {{ $title }}
        </a>
        {{- else }}
          {{ $title }}
        {{- end }}
      </h3>
      {{- if and $context.Params.tool_category }}
        {{ partial "components/badge.html" (dict "text" $context.Params.tool_category "variant" "secondary" "size" "sm") }}
      {{- end }}
    </div>
    {{- end }}

    {{- if $content }}
    <div class="card-system__body">
      <p class="card-system__text">{{ $content }}</p>
    </div>
    {{- end }}

    {{- if $tags }}
    <div class="card-system__tags">
      {{- range $tags }}
        {{ partial "components/badge.html" (dict "text" . "variant" "ghost" "size" "sm") }}
      {{- end }}
    </div>
    {{- end }}

    {{- if or $metadataItems $actionButtons }}
    <div class="card-system__footer">
      {{- if $metadataItems }}
      <div class="card-system__metadata">
        {{- range $metadataItems }}
        <div class="card-system__metadata-item">
          {{ partial "components/icon.html" (dict "name" .icon "size" "sm") }}
          <span>{{ .text }}</span>
        </div>
        {{- end }}
      </div>
      {{- end }}

      {{- if $actionButtons }}
      <div class="card-system__actions">
        {{- range $actionButtons }}
          {{ partial "components/button.html" (dict 
            "href" .href 
            "text" .text 
            "variant" .variant 
            "size" "sm" 
            "icon" .icon 
            "class" "card-system__button"
          ) }}
        {{- end }}
      </div>
      {{- end }}
    </div>
    {{- end }}
  </div>
</div>